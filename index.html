<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ã‚´ãƒ«ãƒ•ã‚³ãƒ³ãƒšçµæœç™ºè¡¨</title>
<style>
  body { font-family: "Helvetica Neue", Arial, sans-serif; background-color: #f4f4f4; color: #333; text-align: center; padding: 20px; }
  h1 { font-size: 1.2rem; margin-bottom: 20px; color: #555; }
  .controls { margin-bottom: 20px; }
  button { background-color: #4CAF50; color: white; border: none; padding: 10px 20px; margin: 5px; border-radius: 5px; font-size: 1rem; cursor: pointer; }
  button.secondary { background-color: #999; }
  button:active { transform: translateY(2px); }
  
  .card { background: white; max-width: 400px; margin: 0 auto; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); min-height: 200px; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; user-select: none; }
  .rank-label { font-size: 1.5rem; color: #888; margin-bottom: 10px; }
  .player-name { font-size: 2rem; font-weight: bold; margin-bottom: 15px; }
  .score-details { font-size: 1.2rem; color: #555; }
  .hidden-holes { font-size: 0.8rem; color: #999; margin-top: 20px; }
  .tap-instruction { margin-top: 20px; font-size: 0.9rem; color: #aaa; animation: blink 2s infinite; }
  
  @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
  .winner { color: #d32f2f; }
  .hidden { display: none; }
</style>
</head>
<body>

<h1>ãƒãƒ¼ãƒ•ã‚³ãƒ³ãƒšçµæœç™ºè¡¨</h1>

<div class="controls">
  <button onclick="init('OUT')">OUT ã‚³ãƒ³ãƒšé–‹å§‹</button>
  <button onclick="init('IN')">IN ã‚³ãƒ³ãƒšé–‹å§‹</button>
</div>

<div id="result-area" class="card hidden" onclick="nextRank()">
  <div id="rank-label" class="rank-label"></div>
  <div id="player-name" class="player-name"></div>
  <div id="score-details" class="score-details"></div>
  <div id="tap-msg" class="tap-instruction">ç”»é¢ã‚’ã‚¿ãƒƒãƒ—ã—ã¦æ¬¡ã‚’è¡¨ç¤º</div>
</div>

<div id="hidden-holes-display" class="hidden-holes"></div>

<script>
// ãƒ‡ãƒ¼ã‚¿å®šç¾©
const pars = {
  OUT: [4, 3, 4, 5, 3, 4, 4, 4, 5], // Total 36
  IN:  [5, 4, 4, 4, 3, 4, 4, 3, 5]  // Total 36
};

const players = [
  { name: "é½‹è—¤ è¿…",   OUT: [7,6,8,9,6,6,9,9,6], IN: [9,8,6,6,6,6,7,4,7] },
  { name: "é…’äº• å‹‡æ¨¹", OUT: [5,7,6,7,3,6,5,6,8], IN: [8,6,5,5,3,5,8,5,7] },
  { name: "é«˜æ©‹ å‹‡å¸Œ", OUT: [6,5,7,11,7,6,6,5,7], IN: [6,6,7,4,4,6,6,6,8] },
  { name: "ä¸­æ‘ æ•æœ—", OUT: [7,5,8,7,3,8,9,5,7], IN: [5,6,8,8,5,6,8,6,7] },
  { name: "ç”ºç”° å•“",   OUT: [4,4,6,7,4,5,4,6,8], IN: [6,7,5,4,3,4,6,3,6] },
  { name: "ä¸¸å±± ç¿”å¸", OUT: [5,3,4,8,3,4,5,8,6], IN: [8,7,5,6,4,4,7,3,6] },
  { name: "å²¡ç”° åº·å¹³", OUT: [7,6,7,8,5,9,7,6,9], IN: [8,7,11,7,3,5,6,6,7] },
  { name: "æ¥ ç”° åŸºå¼˜", OUT: [8,5,9,6,5,8,6,8,11], IN: [5,9,6,6,6,5,7,3,6] }
];

let currentResults = [];
let currentIndex = 0;
let currentSide = "";

// æ—§ãƒšãƒªï¼ˆãƒãƒ¼ãƒ•ï¼‰è¨ˆç®—
// 9ãƒ›ãƒ¼ãƒ«ä¸­3ãƒ›ãƒ¼ãƒ«ã‚’éš ã—ãƒ›ãƒ¼ãƒ«ã¨ã™ã‚‹
// ãƒãƒ³ãƒ‡ = (éš ã—ãƒ›ãƒ¼ãƒ«åˆè¨ˆ * 3 - 36) * 0.8
function calculateResults(side) {
  // éš ã—ãƒ›ãƒ¼ãƒ«ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«3ã¤æ±ºå®š
  let indices = [0,1,2,3,4,5,6,7,8];
  // ã‚·ãƒ£ãƒƒãƒ•ãƒ«
  for (let i = indices.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [indices[i], indices[j]] = [indices[j], indices[i]];
  }
  const hiddenIndices = indices.slice(0, 3).sort((a,b)=>a-b);
  
  // éš ã—ãƒ›ãƒ¼ãƒ«è¡¨ç¤ºç”¨
  const hiddenDisplay = hiddenIndices.map(i => (i+1) + "H").join(", ");
  document.getElementById("hidden-holes-display").innerText = `éš ã—ãƒ›ãƒ¼ãƒ«(${side}): ${hiddenDisplay}`;

  const results = players.map(p => {
    const scores = p[side];
    const gross = scores.reduce((a, b) => a + b, 0);
    
    // éš ã—ãƒ›ãƒ¼ãƒ«ã®åˆè¨ˆ
    let hiddenSum = 0;
    hiddenIndices.forEach(idx => {
      hiddenSum += scores[idx];
    });

    // æ—§ãƒšãƒªè¨ˆç®—: (éš ã—åˆè¨ˆ * 3 - 36) * 0.8
    // é’å¤©äº•ãƒ»ä¸Šé™ãªã—ãªã®ã§ãã®ã¾ã¾è¨ˆç®—
    let hdcp = (hiddenSum * 3 - 36) * 0.8;
    
    // å°‘æ•°ç¬¬1ä½ãªã©ã§ä¸¸ã‚ã‚‹ã®ãŒä¸€èˆ¬çš„ã ãŒã€JSã®æµ®å‹•å°æ•°ç‚¹ã§è¦‹ã‚„ã™ãæ•´å½¢
    hdcp = Math.round(hdcp * 10) / 10; 

    const net = gross - hdcp;

    return {
      name: p.name,
      gross: gross,
      hdcp: hdcp,
      net: net
    };
  });

  // é †ä½ä¸¦ã³æ›¿ãˆ (ãƒãƒƒãƒˆã‚¹ã‚³ã‚¢æ˜‡é † -> ãƒãƒ³ãƒ‡ä¸Šä½(å°‘ãªã„æ–¹ãŒå‰ã„?é€šå¸¸ã¯ãƒãƒ³ãƒ‡ãŒå°‘ãªã„ï¼ä¸Šæ‰‹ã„äººãŒåŒãƒãƒƒãƒˆãªã‚‰è² ã‘ãŒå¤šã„ãŒã€
  // ã“ã“ã§ã¯å¹´åŠŸåºåˆ—ç­‰ãªã„ã®ã§ã€ãƒãƒƒãƒˆæ˜‡é † -> ãƒãƒ³ãƒ‡æ˜‡é † -> ã‚°ãƒ­ã‚¹æ˜‡é †ã§ã‚½ãƒ¼ãƒˆã—ã¾ã™)
  // ä¸€èˆ¬çš„ãªã‚³ãƒ³ãƒš: ãƒãƒƒãƒˆãŒè‰¯ã„é † -> ãƒãƒ³ãƒ‡ãŒå°ã•ã„é † -> å¹´é½¢ or ã‚°ãƒ­ã‚¹
  results.sort((a, b) => {
    if (a.net !== b.net) return a.net - b.net;
    if (a.hdcp !== b.hdcp) return a.hdcp - b.hdcp; // ãƒãƒ³ãƒ‡ãŒå°‘ãªã„æ–¹ãŒä¸Šä½
    return a.gross - b.gross;
  });

  return results;
}

function init(side) {
  currentSide = side;
  currentResults = calculateResults(side);
  // è¡¨ç¤ºã¯ä¸‹ä½ï¼ˆé…åˆ—ã®æœ€å¾Œï¼‰ã‹ã‚‰
  currentIndex = currentResults.length - 1;
  
  document.getElementById("result-area").classList.remove("hidden");
  showRank();
}

function showRank() {
  if (currentIndex < 0) return;

  const data = currentResults[currentIndex];
  const rank = currentIndex + 1;
  
  const rankEl = document.getElementById("rank-label");
  const nameEl = document.getElementById("player-name");
  const detailEl = document.getElementById("score-details");
  const tapEl = document.getElementById("tap-msg");

  if (rank === 1) {
    rankEl.innerHTML = "ğŸ† å„ªå‹ ğŸ†";
    rankEl.classList.add("winner");
    nameEl.classList.add("winner");
    tapEl.innerText = "çµ‚äº†";
  } else {
    rankEl.innerText = `ç¬¬ ${rank} ä½`;
    rankEl.classList.remove("winner");
    nameEl.classList.remove("winner");
    tapEl.innerText = "ã‚¿ãƒƒãƒ—ã—ã¦æ¬¡ã®é †ä½ã¸";
  }

  nameEl.innerText = data.name;
  detailEl.innerHTML = `Gross: ${data.gross} / Hdcp: ${data.hdcp.toFixed(1)}<br>Net: <strong>${data.net.toFixed(1)}</strong>`;
}

function nextRank() {
  if (currentIndex > 0) {
    currentIndex--;
    showRank();
  } else {
    // å„ªå‹è¡¨ç¤ºæ¸ˆã¿
    // alert("çµ‚äº†ã§ã™");
  }
}
</script>

</body>
</html>
